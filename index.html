<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Messenger 3.0</title>
    <base ng-href="/">
    <link rel="stylesheet" type="text/css" href="styles.css"  />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="dark-mode.css" />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script> 
    
    
<!-- These Contents above are for CSS Bootstrap-->    
</head> 
<div class="custom-control custom-switch" style="text-align: right; padding: 10px;">
    <input type="checkbox" class="custom-control-input" id="darkSwitch" />
    <label class="custom-control-label" for="darkSwitch">Dark Mode</label>
  </div>
  <!-- background-color: #111 !important; color: #eee; data-theme="dark" -->
<body style="background-color: rgb(235, 235, 235);"
[data-theme="dark"] {
    background-color: #111 !important;
    color: #eee;
  }> 
<h1 style="font-family:Marker Felt, fantasy; color:steelblue; font-stretch: ultra-expanded; text-align: center;"><img src="https://i.ibb.co/vk2y34G/Chat-Master-Logo.png" alt="ChatMasterLogo" height="80"></h1>
<p style="color:steelblue; font-weight: bold; font-size: large; text-align: center;">Developed by Team 4 in CPS 490</p>
<script src="/socket.io/socket.io.js"></script>

<!-- the login UI here -->
<div class="fade show" style="text-align: center;" id="loginUI">
    
    <div class=grid > 
        <div class="row justify-content-center">
            
           <div class="border rounded p-3 mb-2 bg-dark text-white">
         
              
Please login first: <br>
    <input type="text" class="form-control" id="username" placeholder="Enter your name ..." > <br>
    <input type="password" class= "form-control" id="password" placeholder="Password"> <br>
    <input type="checkbox" onclick=showPassLog()>Show password?<br>
    <button type="button" class="btn btn-primary" onclick="login()">LOGIN</button> 
    <!--Logout button will be moved into chat page as it has no use here-->
    <br>
    
    <!--Registration button for moving to registration page-->
    <br><a href="#" onclick="showRegistrationScreen();hideLoginScreen()">
        New? Register here! </a>
                </div>
        </div>
    </div>
</div>

<!--Registration interface for registering an account-->
<div style="display:none; text-align: center;" id="registrationScreen">
    <div class=grid > 
        <div class="row justify-content-center">
           <div class="border rounded p-3 mb-2 bg-dark text-white">
               
    Register your account: <br>
    <input type="text" class="form-control" id="newusername" placeholder="Enter your name as username ..."> <br>
    <input type="text" class="form-control" id="newemail" placeholder="Enter your email..."> <br>
    <input type="password" class="form-control" id="newpassword" placeholder="Select your password ..."> <br>
    <input type="password" class="form-control" id="verifypassword" placeholder="Please re-enter your password"> <br>
    <input type="checkbox" onclick=showPassReg()>Show password?<br>    
    <button type="button" class="btn btn-primary" onclick="register()">Register User</button><br>
    <a href="#" onclick="hideRegistrationScreen();showLoginScreen()"> Login? </a>
    </div>
</div>
</div>
</div>
<!-- Below is the early format of the user card div, which will display a user profile-->

<div style="display: none" id="profilecard">
    <div class=grid > 
        <div class="row justify-content-center">
           <div class="border rounded p-3 mb-2 bg-dark text-white">
               <div id="profinformationUI">
                <img src="" alt="pfp" id="mypfp" class="img-fluid rounded-circle" height="400px" width="300px"><br>                
                <div id="myusername"></div><br>
                <div id="mytimestamp"></div><br>
                <div id="mydescription">Description: </div>
                <button  type="button" class="btn btn-primary" onclick="hideprof();showeditopt()">Edit Profile?</button>
                <button  type="button" class="btn btn-dark" onclick="hideProfileCard()">Home</button>
            </div>
               <div style="display:none" id="editinfoUI">
                This is your profile
                    Change Username? <br> 
                        <input type="text" id="newUsername" placeholder="Enter your new name ..."> 
                        <button type="button" onclick="changeUsername()">Change</button><br>
                    <button  type="button" class="btn btn-primary" onclick="hideeditopt();showprof()">View Profile?</button>
                    <button  type="button" class="btn btn-dark" onclick="hideProfileCard()">Home</button>
                    </div>
                    </div>
            </div>
        </div>
    </div>
</div>






<!--Beginning of chat UI. All of this appears after logging in--
<div style="display:none;" id="messageUI">
    <!--Actual div for the entire group chat--
    <div class="container lg">
        <div class="row clearfix">
            <div class="col-lg-12">
                <div class="chat-interface">
                     
                <button type="button" class ="btn btn-warning" onclick="quit()">LOGOUT</button>               
                <div class="chat">
                <!--Group chat--
                <div class="border rounded p-3 mb-2 bg-white text-black">
                Chat messages: <br>
                <div id="messages">
                    <ul class=m-b-0>    </ul>
                </div>
                </div>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>
-->

<!--
    Global Message:<br>
        <input type="text" id="globalmessage" placeholder="Text message ..." onkeyup="sendTyping()"> 
        <button type="button"onclick="sendmessage()">Send</button>
        <br\>
        <button type="button" onclick="clearmessage()">Clear Messages</button>

-->
        <div style="width: 100%; display: none" id="appUI">
            <div style="position: absolute; height: 50px; width: auto; text-align:center; right: 0; top: 0; display:none" id="logoutUI">
            </div>
            <div id="ProfileNotif">
                <div class="border rounded-circle" style="height:50px;width:50px">
                    <img src="https://i.stack.imgur.com/l60Hf.png" alt="pfp" class="img-fluid rounded-circle">
                </div>
            </div>
            <ul class="nav nav-tabs"> 
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expande="false">Nav </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Test case</a></li>
                        <li><hr class="dropdown-divider"</li>
                        <li><a class="dropdown-item button" href="#">Test case</a></li>
                        <li><button type="button" class="btn" onclick="showProfileCard()"> Show My Profile </button></li>
                        <li><button type="button" class ="btn btn-warning" onclick="quit()">LOGOUT</button></li>
                    </ul>
                </li>
            </ul>
            <div class="border rounded p-3 mb-2 bg-dark text-white" style="width: 10%; height: 814px; float: left;" id="sidebarUI">
                <ul class="nav flex-column nav-pills nav-fill">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#" onclick="displayPublicChat();hidePrivateChat();hideGroupChat();hideAddFriend()">Public Chat</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#" onclick="displayPrivateChat();hidePublicChat();hideGroupChat();hideAddFriend()">Private Chat</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#" onclick="displayGroupChat();hidePublicChat();hidePrivateChat();hideAddFriend()">Group Chats</a>
                </li>  
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#" onclick="displayAddFriend();hidePublicChat();hidePrivateChat();hideGroupChat()">Add Friend</a>
                </li>  
            </ul>
            </div>
            <div class="border rounded p-3 mb-2 bg-white text-black" style="width: 80%; height: 814px; float: left; background:rgb(63, 189, 221); border: 1px solid black" id="messagesUI">
                <div style=" text-align: left;" id="publicmessageUI">
                    <strong>Public Chat</strong><br>
                    <input type="text" id="globalmessage" placeholder="Text message ..." onkeydown="checkEnterMessage(event)" onkeyup="sendTyping()"> 
                    <button type="button"onclick="sendmessage()">Send</button>
                    <button type="button" onclick="clearmessage()">Clear Messages</button><hr>
                    <div id="typing" class="typing"><br></div>
                </div>
                
                <div style=" text-align: left; display:none; " id="pmessageUI">
                    <strong>Private Chat</strong><br>
                    <input type="text" id="receiver" placeholder="Recipient">
                    <input type="text" id="privatemessage" placeholder="Text message ..." onkeyup="donothing()"> <!--update the sendTyping for private -->
                    <button type="button"onclick="sendprivatemessage()">Send</button> <hr>
                </div>    
                <div style=" text-align: left; display:none; " id="friendmessageUI">
                    <strong>Add friend</strong><br>
                    <input type="text" id="friendmessage" placeholder="Enter friend's username ...">
                    <button type="button" onclick="addFriend()">Add</button>
                    <button type="button" onclick="removeFriend()">Remove</button><hr>
                </div>
                <div style="height: 75px; width: 1534px; text-align: left; display:none;" id="GroupChatUI">
                    <strong>Group Chats</strong><br>
                    <!--<button type="button"onclick="showGCCreationUI()">Create Group Chat</button> <br> -->
                    Your Group Chats: <br>
                    <button type="button"onclick="openchat1()">Chat Room 1</button>
                    <button type="button"onclick="openchat2()">Chat Room 2</button>
                    <button type="button"onclick="openchat3()">Chat Room 3</button>
                
                    <hr>
                    <div style="width: 20%; margin: 0 auto; height: 400px; float: none; text-align: center; background:rgba(238, 241, 38, 0.836); border: 2px solid black; display: none" id="groupchatCreation">
                        <strong>Create A Group Chat</strong> <hr>
                        <button style= "position: relative; left: 136px; top: 310px" type="button" onclick="hideGCCreationUI()">Create Chat</button>
                        <button style="position: relative; right: 171px; top: 310px" type="button" onclick="hideGCCreationUI()">Cancel</button>
                    </div>
                    <div style="width: 20%; margin: 0 auto; height: 100px; position:absolute; left: 600px; top: 275px; text-align: center; background:rgba(238, 241, 38, 0.836); border: 2px solid black; display: none" id="openchat1">
                        <strong>Chat Room1</strong> <hr>
                        <input type="text" id="openchat1messages" placeholder="Text message ..." "> 
                        <button style= "position: relative; left: 0px; " type="button" onclick="sendroom1message()">Send</button>
                        <button style="position: relative; left: 0px; " type="button" onclick="clearroom1message()">Clear</button>
                    </div>
                    <div style="width: 20%; margin: 0 auto; height: 100px; position:absolute; left: 600px; top: 275px; text-align: center; background:rgba(238, 241, 38, 0.836); border: 2px solid black; display: none" id="openchat2">
                        <strong>Chat Room2</strong> <hr>
                        <input type="text" id="openchat2messages" placeholder="Text message ..." "> 
                        <button style= "position: relative; left: 0px;" type="button" onclick="sendroom2message()">Send</button>
                        <button style="position: relative; left: 0px;" type="button" onclick="clearroom2message()">Clear</button>
                    </div>
                    <div style="width: 20%; margin: 0 auto; height: 100px; position:absolute; left: 600px; top: 275px; text-align: center; background:rgba(238, 241, 38, 0.836); border: 2px solid black; display: none" id="openchat3">
                        <strong>Chat Room3</strong> <hr>
                        <input type="text" id="openchat3messages" placeholder="Text message ..." "> 
                        <button style= "position: relative; left: 0px;" type="button" onclick="sendroom3message()">Send</button>
                        <button style="position: relative; left: 0px;" type="button" onclick="clearroom3message()">Clear</button>
                    </div>
                </div>
        
                <br>
        
                <div id="chatUI" style="display:none"; >
                Chat messages: <br>
                <div style="height: 200px; overflow-y: scroll" id="messages"></div>
                </div>
                <div id="chatroom1UI" style="display:none"; >
                Chat messages: <br>
                    <div style="height: 310px; overflow-y: scroll;" id="chatroom1messages"></div>
                    </div>
                <div id="chatroom2UI" style="display:none"; >
                Chat messages: <br>
                    <div style="height: 310px; overflow-y: scroll" id="chatroom2messages"></div>
                    </div>
                <div id="chatroom3UI" style="display:none"; >
                Chat messages: <br>
                    <div style="height: 310px; overflow-y: scroll" id="chatroom3messages"></div>
                    </div>
                <div id="friendchatUI" style="display:none"; >
                Friend messages: <br>
                    <div style="height: 200px; overflow-y: scroll" id="friendmessages"></div>
                    </div>
                <div style="display: none" id="privatechatUI"; >
                Private messages: <br>
                <div style="height: 709px; overflow-y: scroll;" id="privatemessages"></div>
                
                </div>
        
            </div>
        
            <div class="border rounded p-3 mb-2 bg-dark text-white" style="width: 10%; height: 814px; float: left; overflow-y: auto; " id="listofusersUI">
                <div id="userlistUI" >
                <p style="text-align:center;"><strong>Userlist</strong></p>
                <div id="userlist"><br></div>
                </div>
            </div>
        </div>


<!--These should not be displayed until successful authentication run-->
<div id="typing" class="typing"><br></div>

<!--These should not be displayed until successful authentication run-->
<div style="display: none; position: absolute; right: 0; top: 3;" id="userlist">
Userlist: <br></div>



<!--
<div style="display: none; position: absolute; height: 50px; width: auto; text-align:left; right: 0; bottom: 0;" id="pmessageUI">
Private Message:<br>
    <input type="text" id="receiver" placeholder="Recipient">
    <input type="text" id="privatemessage" placeholder="Text message ..." onkeyup="sendTyping()"> 
    <button type="button"onclick="sendprivatemessage()">Send</button>
    <br\>
</div>
<div style="display:none;"id="typing"  class="typing"><br></div>
<hr>
-->


<div style="display:none;"id="typing" class="typing"><br></div>


<!--Base for group chat-->
<div style="display:none ;" id = "private chat"></div>


<script>
    var socketio = io();
    src="darkswitch.js"
    //function when "Join" button is called to login user
    function login(){
        var username = document.getElementById('username').value;
        var password= document.getElementById('password').value;
        if(socketio)
            socketio.emit("login", username,password);
    }
        //document.getElementById('messages').innerHTML='Welcome ' + document.getElementById('username').value + "<br>";
    function register(){
        var username = document.getElementById('newusername').value;
        var email = document.getElementById('newemail').value;
        var password = document.getElementById('newpassword').value;
        var passwordsec = document.getElementById('verifypassword').value;
        //TODO: validate username/password
        if(validateEmail(email)==false){
            alert("insufficient email")
            document.getElementById('newusername').value="";
            document.getElementById('newemail').value="";
            document.getElementById('newpassword').value="";
            document.getElementById('verifypassword').value="";
        }
        else{
            socketio.emit("register",username,email,password,passwordsec);
        }
           
        }
    function validateEmail(email){
        return/^(.+)@(.+)$/.test(email)
    }
       
    function hideRegistrationScreen(){
        document.getElementById("registrationScreen").style.display = "none";//"block" is to display
        }
    function showRegistrationScreen(){
        document.getElementById("registrationScreen").style.display = "block";//"none" is to hide
        }
    function hideLoginScreen(){
        document.getElementById("loginUI").style.display = "none";//"block" is to display
        }
    function showLoginScreen(){
        document.getElementById("loginUI").style.display = "block";//"none" is to hide
        }

    function displayPublicChat(){
        document.getElementById("publicmessageUI").style.display = "block";
        document.getElementById("chatUI").style.display = "block";
        document.getElementById("chatroom1UI").style.display = "none";
        document.getElementById("chatroom2UI").style.display = "none";
        document.getElementById("chatroom3UI").style.display = "none";
    }
    function hidePublicChat(){
        document.getElementById("publicmessageUI").style.display = "none";
        document.getElementById("chatUI").style.display = "none";
    }
    function displayPrivateChat(){
        document.getElementById("pmessageUI").style.display = "block";
        document.getElementById("privatechatUI").style.display = "block";
        document.getElementById("chatroom1UI").style.display = "none";
        document.getElementById("chatroom2UI").style.display = "none";
        document.getElementById("chatroom3UI").style.display = "none";
    }
    function hidePrivateChat(){
        document.getElementById("pmessageUI").style.display = "none";
        document.getElementById("privatechatUI").style.display = "none";
    }
    function displayGroupChat(){
        document.getElementById("GroupChatUI").style.display = "block";
    }
    function hideGroupChat(){
        document.getElementById("GroupChatUI").style.display = "none";
    }
    function displayAddFriend(){
        document.getElementById("friendchatUI").style.display = "block";
        document.getElementById("friendmessageUI").style.display = "block";        
    }
    function hideAddFriend(){
        document.getElementById("friendchatUI").style.display = "none";
        document.getElementById("friendmessageUI").style.display = "none";
    }
    function showGCCreationUI(){
        document.getElementById("groupchatCreation").style.display = "block";
    }
    function hideGCCreationUI(){
        document.getElementById("groupchatCreation").style.display = "none";
    }

    function showProfileCard(){
        document.getElementById("appUI").style.display= "none";
        document.getElementById("profilecard").style.display="block";
        socketio.emit("getuserinfo");
        
    }
    function hideProfileCard(){
        document.getElementById("profilecard").style.display="none";
        document.getElementById("appUI").style.display= "block";
       
    }
    //below four are the profile card functions
    function hideeditopt(){
        socketio.emit("getuserinfo")
        document.getElementById("editinfoUI").style.display = "none";//"block" is to display
        }
    function showeditopt(){
        document.getElementById("editinfoUI").style.display = "block";//"none" is to hide
        }
    function hideprof(){
        document.getElementById("profinformationUI").style.display = "none";//"block" is to display
        }
    function showprof(){
        document.getElementById("profinformationUI").style.display = "block";//"none" is to hide
        }










    function openchat1(){
        document.getElementById("openchat1").style.display = "block";
        document.getElementById("chatroom1UI").style.display = "block";
        document.getElementById("openchat2").style.display = "none";
        document.getElementById("chatroom2UI").style.display = "none";
        document.getElementById("openchat3").style.display = "none";
        document.getElementById("chatroom3UI").style.display = "none";
    }
    function openchat2(){
        document.getElementById("openchat2").style.display = "block";
        document.getElementById("chatroom2UI").style.display = "block";
        document.getElementById("openchat3").style.display = "none";
        document.getElementById("chatroom3UI").style.display = "none";
        document.getElementById("openchat1").style.display = "none";
        document.getElementById("chatroom1UI").style.display = "none";
    }
    function openchat3(){
        document.getElementById("openchat3").style.display = "block";
        document.getElementById("chatroom3UI").style.display = "block";
        document.getElementById("openchat2").style.display = "none";
        document.getElementById("chatroom2UI").style.display = "none";
        document.getElementById("openchat1").style.display = "none";
        document.getElementById("chatroom1UI").style.display = "none";


    }
    //function when "Change" button is called to change username
    function changeUsername(){
        var username = document.getElementById('username').value;
        var newUsername = document.getElementById('newUsername').value;
        if(socketio)
            socketio.emit("changeUsername",username, newUsername);
    }
    //function when "clearmessage" button is called ro clear all message
    function clearmessage(){
                document.getElementById('messages').innerHTML = "";
            }
    function clearroom1message(){
                document.getElementById('chatroom1messages').innerHTML = "";
            }
    function clearroom2message(){
                document.getElementById('chatroom2messages').innerHTML = "";
            }
    function clearroom3message(){
                document.getElementById('chatroom3messages').innerHTML = "";
            }
    socketio.on("welcome", (welcomemessage) => {
            document.getElementById('publicmessages').innerHTML += welcomemessage + "<br>";
        });
    
    //use this to see/hide information upon input
    socketio.on("registration", (result) => {
        var username = document.getElementById('newusername').value;
        if(result==="Success"){
            alert("You can login now!");
            hideRegistrationScreen();
            showLoginScreen();
            return
            }
        if(result==="UserExist"){
            alert("Username '" + username + "' exists. Please try again!" );
        if(result==="EmailExist"){
            alert("Email"+ email + "exists. Please enter a unique email!")
        }
        }else{
            alert("User registration error. Please try again!" );
            }
            document.getElementById('newusername').value="";
            document.getElementById('newemail').value="";
            document.getElementById('newpassword').value="";
            document.getElementById('newusername').focus();
            })
    socketio.on("badpassreenter", (result) => {    
        alert("Your passwords do not match!");
        document.getElementById('newusername').value="";
        document.getElementById('newpassword').value="";
        document.getElementById('verifypassword').value="";
     })
    
    socketio.on("badusername", (result)=>{
        alert("Your username is too short,it must at least 5 letters!");
        document.getElementById('newusername').value="";
        document.getElementById('newemail').value="";
        document.getElementById('newpassword').value="";
        document.getElementById('verifypassword').value="";
    })
    socketio.on("badusername", (result)=>{
        alert("Your Email is invalid!");
        document.getElementById('newusername').value="";
        document.getElementById('newemail').value="";
        document.getElementById('newpassword').value="";
        document.getElementById('verifypassword').value="";
    })




    socketio.on("UpdateUserList", (Userlist) => {
        document.getElementById('userlist').innerHTML = "";
        for(var x in Userlist){
            document.getElementById('userlist').innerHTML += Userlist[x] + "<br>";
        }
    })
    //function when user is typing it will shows "user is typing"
    socketio.on("<TYPING>", function(msg){ 
        document.getElementById("typing").innerHTML = sanitizeHTML(msg) + " is typing <span>.</span><span>.</span><span>.</span>";      
        setTimeout(function(){document.getElementById("typing").innerHTML = "<br>";},3000);
        console.log('<TYPING>Received from server: ' + msg);
    
    });
    // function that shows the name of the online user
    socketio.on("<URLIST>", function(msg){
        document.getElementById("userlist").innerHTML = msg;		
	      console.log('<URLIST>Received from server: ' + msg);
	
    });
    socketio.on("friend", (friendText) => {
        document.getElementById('friendmessages').innerHTML += friendText + "<br>";
    });
    socketio.on("removefriend", (removefriendText) => {
        document.getElementById('friendmessages').innerHTML += removefriendText + "<br>";
    });
    // function to show the chatmessage
    socketio.on("chat", (chatmessage) => {
        document.getElementById('messages').innerHTML += sanitizeHTML(chatmessage) + "<br>";       
    });
    //function to show the chatmessage in room1
    socketio.on("chatroom1", (chatroom1message) => {
        document.getElementById('chatroom1messages').innerHTML += chatroom1message + "<br>";       
    });
    //function to show the chatmessage in room2
    socketio.on("chatroom2", (chatroom2message) => {
        document.getElementById('chatroom2messages').innerHTML += chatroom2message + "<br>";       
    });
    //function to show the chatmessage in room3
    socketio.on("chatroom3", (chatroom3message) => {
        document.getElementById('chatroom3messages').innerHTML += chatroom3message + "<br>";       
    });
    //function to show the private message
    socketio.on("pchat", (pmTo, chatmessage) => {
            var receiver = pmTo;
            var message = chatmessage;
            //loop through sockets to find username that matches pmTo and update their messages
        document.getElementById('privatemessages').innerHTML += message + "<br>";
        
    });

    socketio.on("username updated",(newusername_result)=>{
        alert("Congradulations, your username has been successfully updated");
        document.getElementById("newUsername")="";
    })
    socketio.on("existing username",(newusername_result)=>{
        alert("This username has already been taken by someone else. Please try a different one.");
        document.getElementById("newUsername")="";
    })
    socketio.on("Error",(newusername_result)=>{
        alert("There was an error updating your username");
        document.getElementById("newUsername").value="";
    })

    function showPassLog(){
        var pass=document.getElementById('password');
        if(pass.type=="password"){
            pass.type="text";
        }
        else{
            pass.type="password";
        }
    }
    function showPassReg(){
         
        var pass=document.getElementById('newpassword');
        var passn = document.getElementById('verifypassword');
        if(pass.type=="password"){
            pass.type="text";
            passn.type="text";
        }
        else{
            pass.type="password";
            passn.type="password";
        }
    }
    function addFriend() { //sends friend request to the chatserver based on friends name
         socketio.emit("friend", document.getElementById('friendmessage').value);
         document.getElementById('friendmessage').value="";
    }
    function removeFriend() { //sends friend request to the chatserver based on friends name
         socketio.emit("removefriend", document.getElementById('friendmessage').value);
         document.getElementById('friendmessage').value="";
    }
    //function when message is sent to all users
    function sendmessage(){        
        socketio.emit("chat", document.getElementById('globalmessage').value);
        document.getElementById('globalmessage').value="";
    }
    //function when meessage is sent to users in chat room1
    function sendroom1message(){        
        socketio.emit("chatroom1", document.getElementById('openchat1messages').value);
        document.getElementById('openchat1messages').value="";
    }
    //function when meessage is sent to users in chat room2
    function sendroom2message(){        
        socketio.emit("chatroom2", document.getElementById('openchat2messages').value);
        document.getElementById('openchat2messages').value="";
    }
    //function when meessage is sent to users in chat room3
    function sendroom3message(){        
        socketio.emit("chatroom3", document.getElementById('openchat3messages').value);
        document.getElementById('openchat3messages').value="";
    }
    //function when message is sent to specific user
    function sendprivatemessage(){
        //var Rec_Msg = [document.getElementById('receiver').value, document.getElementById('privatemessage').value];   
        socketio.emit("pm", document.getElementById('receiver').value, document.getElementById('privatemessage').value);
        document.getElementById('privatemessage').value="";
    }
    //function for pressing enter on login
    function checkEnterMessage(event){
        //console.log("event.key="+event.key) //for testing only
        if (event.key === "Enter") sendmessage()
    }



    //function when user wanna quit the login
    function quit(){
        socketio.emit("quit", document.getElementById('username').value);
        document.getElementById("publicmessageUI").style.display="none";
        document.getElementById("loginUI").style.display="block";
        document.getElementById("appUI").style.display = "none";
        document.getElementById("pmessageUI").style.display = "none";
        hidePrivateChat();
        hideGroupChat();
        document.getElementById("chatUI").style.display = "none";
        document.getElementById("changeUsernameUI").style.display = "none";
        document.getElementById("logoutUI").style.display = "none";        
        alert("You have been logged out");

    }
     function sendTyping(){
                socketio.emit("<TYPING>");
        console.log('Sent to server: <TYPING>');
        }
    var sanitizeHTML = function (str) {
        var temp = document.createElement('div');
        temp.textContent = str;
        return temp.innerHTML;
        };
    socketio.on("authenticated",()=>{
    document.getElementById("loginUI").style.display="none";
    document.getElementById("appUI").style.display="block";
    document.getElementById("chatUI").style.display="block";
    document.getElementById("publicmessageUI").style.display = "block";
    //document.getElementById("pmessageUI").style.display = "block";
    //document.getElementById("changeUsername").style.display = "block";
    document.getElementById("userlistUI").style.display = "block";
    document.getElementById("messages").innerHTML+= "You are successfully logged in! Can start chatting now.<br>"
    });
    socketio.on("InvalidLogin", (invalidlgMessage) => {
        document.getElementById('username').value="";
        document.getElementById('password').value="";
        alert("You have input an invalid login. Please try again or register for an account!" );
        //document.getElementById('loginalert').style.display = "block";
        //Works on one attempt but needs to be adjusted for later
    });
    socketio.on("chat_history",(chat_history) => {
        //debug if needed: e.g., JSON.stringify(chat_history))
        if(chat_history && chat_history.length > 0){
            for(let index in chat_history){
            let chatmessage = chat_history[index].message
            let time = new Date(chat_history[index].timestamp)
            document.getElementById('messages').innerHTML+=
            "On " + time + "," + chatmessage + "<br>";
            }
        }
    socketio.on("private_chat_history", (private_chat_history) => {
        if(private_chat_history && private_chat_history.length > 0){
            for(let index in private_chat_history){
                let privateChatMessage = private_chat_history[index].message;
                let time = new Date(private_chat_history[index].timestamp);
                document.getElementById('privatemessages').innerHTML+= "On " + time + ", " + privateChatMessage + "<br>";
            }
        }
    });
    socketio.on("group1_chat_history", (group1_chat_history) =>{
        if(group1_chat_history && group1_chat_history.length > 0){
            for(let index in group1_chat_history){
                let msg = group1_chat_history[index].message;
                let time = new Date(group1_chat_history[index].timestamp);
                document.getElementById('chatroom1messages').innerHTML+= "On " + time + ", " + msg + "<br>";
            }
        }
    });
    socketio.on("group2_chat_history", (group2_chat_history) =>{
        if(group2_chat_history && group2_chat_history.length > 0){
            for(let index in group2_chat_history){
                let msg = group2_chat_history[index].message;
                let time = new Date(group2_chat_history[index].timestamp);
                document.getElementById('chatroom2messages').innerHTML+= "On " + time + ", " + msg + "<br>";
            }
        }
    });
    socketio.on("group3_chat_history", (group3_chat_history) =>{
        if(group3_chat_history && group3_chat_history.length > 0){
            for(let index in group3_chat_history){
                let msg = group3_chat_history[index].message;
                let time = new Date(group3_chat_history[index].timestamp);
                document.getElementById('chatroom3messages').innerHTML+= "On " + time + ", " + msg + "<br>";
            }
        }
    });    

    //function for personal profile
    socketio.on("returneduserinfo", (user_info)=>{
        //user info is just what we have for now, on server end, we need to get all the info
        //that we need for a profile
        document.getElementById("mypfp").src= user_info[0].pfp;
        document.getElementById("myusername").innerHTML= user_info[0].user_name;
        
        let time = new Date(chat_history[0].timestamp)
        document.getElementById("timestamp").innerHTML= "Date Created: "+time;
        document.getElementById("mydescription").innerHTML= user_info[0].description;


    })
    socketio.on("defaultuserinfo", (user_info) => {
        document.getElementById("mypfp").src= "https://i.stack.imgur.com/l60Hf.png";
        document.getElementById("myusername").innerHTML= "Your_Account";
        document.getElementById("mytimestamp").innerHTML= "Date Created: TODAY!";
        document.getElementById("mydescription").innerHTML= "This is my account, I'm so happy";

    })
})
</script>


<!---Alerts will be displayed below, alerts are a notif type from boostrap css-->
<div id="loginalert" class="alert hide alert-danger alert-dismissible fade show"  role="alert" style="display:none;">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
      </svg>
    Incorrect login credentials! You may want to register.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>




<div id="chatUI" >
    <div id="messages"></div>
</div>


<!--Test case for bubble messenger-->
<div class="row chat-bubble">
    <div class="col mb-3">
    </div>
    <div class="col mb-9"></div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="theme.js"></script>
<script src="dark-mode-switch.min.js"></script>
<p style="color:steelblue; font-size: small; text-align: center;">CAPSTONE 1, Version 3.0.1, Last Updated: 12/2/2021 <br> Developed by: Ryan Downes, Joe Durham, Max Onkst, Zihan Liu</p>
</body>
</html>
